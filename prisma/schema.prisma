generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum EffortLevel {
  low
  medium
  high
}

enum WeekDay {
  sun
  mon
  tue
  wed
  thu
  fri
  sat
}

enum DaySlot {
  breakfast
  lunch
  dinner
  snack
}

model User {
  id              Int             @id @default(autoincrement())
  displayName     String
  email           String          @unique
  weekStartDay    WeekDay

  createdAt       DateTime        @default(now())
  
  recipes         Recipe[]
  plannerWeeks    PlannerWeek[] 
}

model Recipe {
  id             Int           @id @default(autoincrement())
  userId         Int
  user           User          @relation(fields: [userId], references: [id])
  name           String
  ingredients    RecipeIngredient[]
  effortLevel    EffortLevel
  totalCalories  Int?

  plannerEntries PlannerEntry[]

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

model RecipeIngredient {
  recipeId      Int
  ingredientId  Int
  
  recipe        Recipe        @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  ingredient    Ingredient    @relation(fields: [ingredientId], references: [id])

  quantity      String?
  notes         String?

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@id([recipeId, ingredientId])
}

model Ingredient {
  id        Int     @id @default(autoincrement())
  name      String  @unique

  recipes   RecipeIngredient[]

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

model PlannerEntry {
  id        Int        @id @default(autoincrement())
  weekId    Int
  week      PlannerWeek @relation(fields: [weekId], references: [id])
  day       WeekDay
  slot      DaySlot
  recipeId  Int?
  recipe    Recipe?    @relation(fields: [recipeId], references: [id], onDelete: SetNull)

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@unique([weekId, day, slot])
}

model PlannerWeek {
  id        Int        @id @default(autoincrement())
  userId    Int
  user      User       @relation(fields: [userId], references: [id])

  startDate DateTime
  plannerEntries  PlannerEntry[]

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@unique([userId, startDate])
}